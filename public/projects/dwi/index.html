<!doctype html><html lang=en dir=auto><head><script src="/JulienGenzling.github.io/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=JulienGenzling.github.io/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Diffusion-weighted imaging theory | JG</title>
<meta name=keywords content><meta name=description content="Here&rsquo;s an overview of how MRI works:
Magnetic Alignment: The MRI scanner generates a strong magnetic field that aligns the protons in the body&rsquo;s hydrogen atoms, which are abundant in water and fat.
Radiofrequency Pulses: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil)."><meta name=author content="Julien Genzling"><link rel=canonical href=http://localhost:1313/JulienGenzling.github.io/projects/dwi/><link crossorigin=anonymous href=/JulienGenzling.github.io/assets/css/stylesheet.19834c6c40982c384456e404a11633a67d5dcaf6c3b20eb11d31d53e9a386681.css integrity="sha256-GYNMbECYLDhEVuQEoRYzpn1dyvbDsg6xHTHVPpo4ZoE=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/JulienGenzling.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/JulienGenzling.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/JulienGenzling.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/JulienGenzling.github.io/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/JulienGenzling.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/JulienGenzling.github.io/projects/dwi/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:title" content="Diffusion-weighted imaging theory"><meta property="og:description" content="Here&rsquo;s an overview of how MRI works:
Magnetic Alignment: The MRI scanner generates a strong magnetic field that aligns the protons in the body&rsquo;s hydrogen atoms, which are abundant in water and fat.
Radiofrequency Pulses: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil)."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/JulienGenzling.github.io/projects/dwi/"><meta property="og:image" content="http://localhost:1313/JulienGenzling.github.io/projects/dwi/dwi.png"><meta property="article:section" content="projects"><meta property="article:published_time" content="2024-07-23T14:00:00+00:00"><meta property="article:modified_time" content="2024-07-23T14:00:00+00:00"><meta property="og:site_name" content="Julien Genzling"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/JulienGenzling.github.io/projects/dwi/dwi.png"><meta name=twitter:title content="Diffusion-weighted imaging theory"><meta name=twitter:description content="Here&rsquo;s an overview of how MRI works:
Magnetic Alignment: The MRI scanner generates a strong magnetic field that aligns the protons in the body&rsquo;s hydrogen atoms, which are abundant in water and fat.
Radiofrequency Pulses: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Projects","item":"http://localhost:1313/JulienGenzling.github.io/projects/"},{"@type":"ListItem","position":2,"name":"Diffusion-weighted imaging theory","item":"http://localhost:1313/JulienGenzling.github.io/projects/dwi/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Diffusion-weighted imaging theory","name":"Diffusion-weighted imaging theory","description":"Here\u0026rsquo;s an overview of how MRI works:\nMagnetic Alignment: The MRI scanner generates a strong magnetic field that aligns the protons in the body\u0026rsquo;s hydrogen atoms, which are abundant in water and fat.\nRadiofrequency Pulses: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil).","keywords":[],"articleBody":"Here’s an overview of how MRI works:\nMagnetic Alignment: The MRI scanner generates a strong magnetic field that aligns the protons in the body’s hydrogen atoms, which are abundant in water and fat.\nRadiofrequency Pulses: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil).\nRelaxation: After the RF pulses are turned off, the protons begin to relax back to their original alignment. As they do, they release the absorbed energy. This relaxation occurs at different rates in different tissues, described by T1 and T2 relaxation times.\nSignal Detection: The released energy during relaxation generates signals that are detected by the MRI scanner’s receivers. These signals are then processed by a computer to construct detailed images of the body’s internal structures.\nBy carefully controlling the timing and strength of the RF pulses, MRI can produce various types of images. Two common types of MRI sequences are T1-weighted and T2-weighted images. T1-weighted sequences provide high-resolution images where fat appears bright and water appears dark, making them useful for visualizing anatomical details. T2-weighted sequences, on the other hand, highlight differences in water content, with water appearing bright and fat appearing dark, which is particularly useful for detecting edema, inflammation, and other fluid-related abnormalities. Together, T1 and T2 sequences offer complementary information, aiding in comprehensive diagnostic evaluations.\nDiffusion-weighted magnetic resonance imaging (DWI or dMRI) uses specific MRI sequences and software to generate images based on the diffusion of water molecules, creating contrast in MR images. This technique enables the mapping of the diffusion process of molecules, primarily water, in biological tissues, in vivo and non-invasively.\nThe brain is composed of white matter and gray matter. White matter mainly consists of myelinated axons responsible for transmitting signals between different brain regions. Gray matter contains neuronal cell bodies, dendrites, and unmyelinated axons, involved in processing and regulating information.\nMolecular diffusion in brain tissues is not random but reflects interactions with various obstacles such as axons, cell membranes, and other neural components, especially in white matter. Therefore, the diffusion patterns of water molecules can reveal microscopic details about tissue architecture, whether normal or diseased.\nThe Physics of Diffusion Isotropic Diffusion Diffusion, as described by Fick’s laws, involves the movement of particles driven by concentration differentials. Fick’s first law states that the flux $F(r, t)$ of particles is proportional to the negative gradient of concentration $C(r, t)$, where $D$ is the diffusion coefficient:\n$ F(r, t) = -D \\nabla C(r, t) \\quad $\nFick’s second law, derived from the conservation of mass, links flux to changes in concentration over time:\n$ D \\nabla^2 C(r, t) = \\frac{\\partial C(r, t)}{\\partial t} \\quad $\nThe probability density $P(r, t)$ of finding a particle per unit volume obeys a similar diffusion equation:\n$ D \\nabla^2 P(r, t) = \\frac{\\partial P(r, t)}{\\partial t} \\quad $\nFor unrestricted isotropic diffusion, the solution for $P(r|r_0, t)$, the probability density function of finding a particle at position $r$ given it started at $r_0$ at time $t = 0$, is:\n$ P(r|r_0, t) = \\left( \\frac{4 \\pi Dt}{N} \\right)^{-\\frac{3}{2}} \\exp \\left( -\\frac{|r - r0|^2}{4Dt} \\right) $\nThe mean square displacement $\\langle \\Delta r \\rangle^2$ of diffusing particles over time $t$ is given by:\n$ \\langle \\Delta r \\rangle^2 = 2NDt $\nwhere $N$ is the dimensionality of diffusion (1 for line, 2 for plane, 3 for free space), reflecting Einstein’s description of diffusion behavior.\nAnisotropic Diffusion When Brownian motion exhibits non-uniform spatial characteristics, a single scalar diffusion coefficient becomes insufficient to fully characterize the system. Instead, the flux of particles $F$ can be described using a diffusion tensor $\\mathbf{D}$:\n$ F = -D \\nabla C $\nHere, $D$ is a symmetric $3 \\times 3$ matrix that accounts for the anisotropic nature of diffusion. Due to the requirement of real values, the diffusion tensor $\\textbf{D}$ satisfies $D_{ij} = D_{ji}$, with only six independent elements:\n$$ \\textbf{D} = \\begin{pmatrix} D_{xx} \u0026 D_{xy} \u0026 D_{xz} \\\\ D_{xy} \u0026 D_{yy} \u0026 D_{yz} \\\\ D_{xz} \u0026 D_{yz} \u0026 D_{zz} \\end{pmatrix} $$\nFor a compartment governed by the diffusion tensor $D$, the probability that a particle initially at position $\\mathbf{r_0}$ reaches position $\\textbf{r}$ at time $t$ is given by:\n$ P(\\mathbf{r}|\\mathbf{r_0}, t) = \\frac{1}{\\sqrt{|\\mathbf{D}|(4\\pi t)^3}} \\exp \\left( -\\frac{(\\mathbf{r} - \\mathbf{r_0})^T \\mathbf{D}^{-1} (\\mathbf{r} - \\mathbf{r_0})}{4t} \\right) $\nWith, $|\\mathbf{D}|$ denotes the determinant of $\\mathbf{D}$, encapsulating the volume scaling factor of the diffusion process. In this model, introduced by Basser et al, diffusion is described by a multivariate normal distribution.\ndMRI Physics The decrease in the spin echo signal, caused by the loss of coherence among nuclear spins due to both their translational movement and the application of well-defined spatial gradient pulses, serves as a method to quantify motion. A widely utilized technique for measuring diffusion involves modifying the spin echo sequence, known as pulsed gradient spin echo (PGSE), originally pioneered by Stejskal and Tanner.\nWe can show that for such sequence, the measured signal will verify the following equation:\n$ \\frac{S}{S_0} = \\exp(-\\gamma^2G^2\\delta^2(\\Delta-\\frac{1}{3}\\delta)D) $\nWhere $\\delta$ is the duration of the dradient, $\\Delta$ is the diffusion time (the time between the two leading edges of the gradient pulses), $G$ is the gradient strength, $S$ is the measured signal, $S_0$ is the measured signal in the absence of diffusion weighting gradient, $\\gamma$ is the gyromagnetic ratio and $D$ is the diffusion coefficient.\nWe can rewrite this equation:\n$ S = S_0e^{-bD} $\nwhere $b$ is the b-value, defined by:\n$ b = \\gamma^2G^2\\delta^2(\\Delta-\\frac{1}{3}\\delta) $\nThis value has units s/mm² and represents the sensitivity of the sequence to motion. A high b-value indicates a greater diffusion weighting of the image.\nDTI MR Diffusion Tensor Spectroscopy and Imaging (1994)\nIf the diffusion is anisotropic, Basser et al [MR Diffusion Tensor Spectroscopy and Imaging] derived a formula that relates the signal attenuation to the diffusion tensor $\\textbf{D}$ by:\n$ \\frac{S}{S_0} = e^{-\\textbf{B}:\\textbf{D}} $\nwith :\n$ \\textbf{B} = \\begin{bmatrix} br_x^2 \u0026 br_xr_y \u0026 br_xr_z \\\\ br_xr_y \u0026 br_y^2 \u0026 br_yr_z \\\\ br_xr_z \u0026 br_yr_z \u0026 br_z^2 \\end{bmatrix} $\nwhere $\\textbf{r} = (r_x, r_y, r_z)$ is the gradient direction.\nWe can then write :\n$ S(b,\\textbf{r}) = S_0e^{-br_x^2D_{xx}-br_y^2D_{yy}-br_z^2D_{zz}-2br_xr_yD_{xy}-2br_xr_zD_{xz}-2br_yr_zD_{yz}} = S_0e^{—b\\textbf{r}^T\\textbf{Dr}} $\nWe therefore need a minimum of six non-collinear diffusion measurements to fully estimate the diffusion tensor coefficients :\n$ \\mathbf{d} = \\mathbf{H}^{-1}\\mathbf{Y} $\nwith $\\mathbf{d} = \\begin{bmatrix} D_{xx} \\\\ D_{yy} \\\\ D_{zz} \\\\ D_{xy} \\\\ D_{xz} \\\\ D_{yz} \\\\ \\end{bmatrix}$, $\\quad \\mathbf{H} = \\begin{bmatrix} r_{x1}^2 \u0026 r_{y1}^2 \u0026 r_{z1}^2 \u0026 2r_{x1}r_{y1} \u0026 2r_{x1}r_{z1} \u0026 2r_{y1}r_{z1}\\\\ \u0026 \u0026 \u0026.\\\\ \u0026 \u0026 \u0026.\\\\ \u0026 \u0026 \u0026.\\\\ \u0026 \u0026 \u0026.\\\\ r_{x6}^2 \u0026 r_{y6}^2 \u0026 r_{z6}^2 \u0026 2r_{x6}r_{y6} \u0026 2r_{x6}r_{z6} \u0026 2r_{y6}r_{z6} \\\\ \\end{bmatrix}$, $\\quad \\textbf{Y} = \\begin{bmatrix} \\frac{\\ln(\\frac{S_0}{S_1})}{b} \\\\ . \\\\ . \\\\ . \\\\ . \\\\ \\frac{\\ln(\\frac{S_0}{S_6})}{b} \\end{bmatrix}$\nIn each voxel of 3D DWI image, the diffusion tensor may be visualized as an ellipsoid with the eigenvectors defining the directions of the principal axes and the ellipsoidal radii defined by the eigenvalues. When the diffusion is isotropic, all the eigenvalues are nearly equal. Otherwise, the eigenvalues are significantly different in magnitude. Tissue injury, diseases or normal physiological changes like aging modify the local tissue microstructure and therefore the eigenvalue magnitudes. The diffusion tensor is therefore a sensitive probe for characterizing both normal and abnormal tissue microstructure.\nModelling white matter with spherical deconvolution: How and why?\nDiffusion and MRI\nhttps://www.ncbi.nlm.nih.gov/pmc/articles/PMC2041910/pdf/13311_2011_Article_40300316.pdf\n","wordCount":"1280","inLanguage":"en","image":"http://localhost:1313/JulienGenzling.github.io/projects/dwi/dwi.png","datePublished":"2024-07-23T14:00:00Z","dateModified":"2024-07-23T14:00:00Z","author":{"@type":"Person","name":"Julien Genzling"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/JulienGenzling.github.io/projects/dwi/"},"publisher":{"@type":"Organization","name":"JG","logo":{"@type":"ImageObject","url":"http://localhost:1313/JulienGenzling.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/JulienGenzling.github.io/ accesskey=h title="Julien Genzling (Alt + H)"><img src=http://localhost:1313/JulienGenzling.github.io/taupek.jpeg alt aria-label=logo height=30>Julien Genzling</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/JulienGenzling.github.io/paper-reviews/ title="Paper Reviews"><span>Paper Reviews</span></a></li><li><a href=http://localhost:1313/JulienGenzling.github.io/gallery/ title="Art gallery"><span>Art gallery</span></a></li><li><a href=http://localhost:1313/JulienGenzling.github.io/projects/ title=Projects><span>Projects</span></a></li></ul></nav></header><style>.nav{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 20px}.logo{display:flex;align-items:center}.logo-img{width:24px;height:24px;margin-right:5px}.logo-img{width:24px;height:24px;border-radius:15%;margin-right:5px;transition:transform 1s cubic-bezier(.25,1,.5,1)}.logo-img:hover{animation:spin 1s cubic-bezier(.25,1,.5,1)forwards}@keyframes spin{0%{transform:rotate(0)}80%{transform:rotate(355)}100%{transform:rotate(360deg)}}.logo-switches{margin-left:20px}</style><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/JulienGenzling.github.io/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/JulienGenzling.github.io/projects/>Projects</a></div><h1 class="post-title entry-hint-parent">Diffusion-weighted imaging theory</h1><div class=post-meta><span title='2024-07-23 14:00:00 +0000 UTC'>July 23, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Julien Genzling</div></header><figure class=entry-cover><img loading=eager src=http://localhost:1313/JulienGenzling.github.io/projects/dwi/dwi.png alt=csd-msmt></figure><div class=post-content><p>Here&rsquo;s an overview of how MRI works:</p><ul><li><p><strong>Magnetic Alignment</strong>: The MRI scanner generates a strong magnetic field that aligns the protons in the body&rsquo;s hydrogen atoms, which are abundant in water and fat.</p></li><li><p><strong>Radiofrequency Pulses</strong>: The scanner then emits RF pulses at a specific frequency that matches the resonance frequency of the aligned protons. These pulses provide energy, causing the protons to tip out of their alignment with the magnetic field (for example, a 90° RF pulse tips the aligned protons by 90 degrees from their inital alignment with the main magnetic field (B0), from $ z $-axis to transverse plane ($x-y$ plane), this tipping creates a detectable signal in the MRI receiver coil).</p></li><li><p><strong>Relaxation</strong>: After the RF pulses are turned off, the protons begin to relax back to their original alignment. As they do, they release the absorbed energy. This relaxation occurs at different rates in different tissues, described by T1 and T2 relaxation times.</p></li><li><p><strong>Signal Detection</strong>: The released energy during relaxation generates signals that are detected by the MRI scanner&rsquo;s receivers. These signals are then processed by a computer to construct detailed images of the body&rsquo;s internal structures.</p></li></ul><p>By carefully controlling the timing and strength of the RF pulses, MRI can produce various types of images. Two common types of MRI sequences are T1-weighted and T2-weighted images. T1-weighted sequences provide high-resolution images where fat appears bright and water appears dark, making them useful for visualizing anatomical details. T2-weighted sequences, on the other hand, highlight differences in water content, with water appearing bright and fat appearing dark, which is particularly useful for detecting edema, inflammation, and other fluid-related abnormalities. Together, T1 and T2 sequences offer complementary information, aiding in comprehensive diagnostic evaluations.</p><p>Diffusion-weighted magnetic resonance imaging (DWI or dMRI) uses specific MRI sequences and software to generate images based on the diffusion of water molecules, creating contrast in MR images. This technique enables the mapping of the diffusion process of molecules, primarily water, in biological tissues, in vivo and non-invasively.</p><p>The brain is composed of white matter and gray matter. White matter mainly consists of myelinated axons responsible for transmitting signals between different brain regions. Gray matter contains neuronal cell bodies, dendrites, and unmyelinated axons, involved in processing and regulating information.</p><p>Molecular diffusion in brain tissues is not random but reflects interactions with various obstacles such as axons, cell membranes, and other neural components, especially in white matter. Therefore, the diffusion patterns of water molecules can reveal microscopic details about tissue architecture, whether normal or diseased.</p><p><img loading=lazy src=../../projects/dwi/wm.png alt="white matter"></p><h3 id=the-physics-of-diffusion>The Physics of Diffusion<a hidden class=anchor aria-hidden=true href=#the-physics-of-diffusion>#</a></h3><h4 id=isotropic-diffusion>Isotropic Diffusion<a hidden class=anchor aria-hidden=true href=#isotropic-diffusion>#</a></h4><p>Diffusion, as described by Fick&rsquo;s laws, involves the movement of particles driven by concentration differentials. Fick&rsquo;s first law states that the flux $F(r, t)$ of particles is proportional to the negative gradient of concentration $C(r, t)$, where $D$ is the diffusion coefficient:</p><p>$
F(r, t) = -D \nabla C(r, t) \quad
$</p><p>Fick&rsquo;s second law, derived from the conservation of mass, links flux to changes in concentration over time:</p><p>$
D \nabla^2 C(r, t) = \frac{\partial C(r, t)}{\partial t} \quad
$</p><p>The probability density $P(r, t)$ of finding a particle per unit volume obeys a similar diffusion equation:</p><p>$
D \nabla^2 P(r, t) = \frac{\partial P(r, t)}{\partial t} \quad
$</p><p>For unrestricted isotropic diffusion, the solution for $P(r|r_0, t)$, the probability density function of finding a particle at position $r$ given it started at $r_0$ at time $t = 0$, is:</p><p>$
P(r|r_0, t) = \left( \frac{4 \pi Dt}{N} \right)^{-\frac{3}{2}} \exp \left( -\frac{|r - r0|^2}{4Dt} \right)
$</p><p>The mean square displacement $\langle \Delta r \rangle^2$ of diffusing particles over time $t$ is given by:</p><p>$
\langle \Delta r \rangle^2 = 2NDt
$</p><p>where $N$ is the dimensionality of diffusion (1 for line, 2 for plane, 3 for free space), reflecting Einstein&rsquo;s description of diffusion behavior.</p><h4 id=anisotropic-diffusion>Anisotropic Diffusion<a hidden class=anchor aria-hidden=true href=#anisotropic-diffusion>#</a></h4><p>When Brownian motion exhibits non-uniform spatial characteristics, a single scalar diffusion coefficient becomes insufficient to fully characterize the system. Instead, the flux of particles $F$ can be described using a diffusion tensor $\mathbf{D}$:</p><p>$
F = -D \nabla C
$</p><p>Here, $D$ is a symmetric $3 \times 3$ matrix that accounts for the anisotropic nature of diffusion. Due to the requirement of real values, the diffusion tensor $\textbf{D}$ satisfies $D_{ij} = D_{ji}$, with only six independent elements:</p><p>$$
\textbf{D} = \begin{pmatrix}
D_{xx} & D_{xy} & D_{xz} \\
D_{xy} & D_{yy} & D_{yz} \\
D_{xz} & D_{yz} & D_{zz}
\end{pmatrix}
$$</p><p>For a compartment governed by the diffusion tensor $D$, the probability that a particle initially at position $\mathbf{r_0}$ reaches position $\textbf{r}$ at time $t$ is given by:</p><p>$
P(\mathbf{r}|\mathbf{r_0}, t) = \frac{1}{\sqrt{|\mathbf{D}|(4\pi t)^3}} \exp \left( -\frac{(\mathbf{r} - \mathbf{r_0})^T \mathbf{D}^{-1} (\mathbf{r} - \mathbf{r_0})}{4t} \right)
$</p><p>With, $|\mathbf{D}|$ denotes the determinant of $\mathbf{D}$, encapsulating the volume scaling factor of the diffusion process.
In this model, introduced by Basser et al, diffusion is described by a multivariate normal distribution.</p><h4 id=dmri-physics>dMRI Physics<a hidden class=anchor aria-hidden=true href=#dmri-physics>#</a></h4><p>The decrease in the spin echo signal, caused by the loss of coherence among nuclear spins due to both their translational movement and the application of well-defined spatial gradient pulses, serves as a method to quantify motion. A widely utilized technique for measuring diffusion involves modifying the spin echo sequence, known as pulsed gradient spin echo (PGSE), originally pioneered by Stejskal and Tanner.</p><p><img loading=lazy src=../../projects/dwi/pulse.png alt=pulse></p><p>We can show that for such sequence, the measured signal will verify the following equation:</p><p>$
\frac{S}{S_0} = \exp(-\gamma^2G^2\delta^2(\Delta-\frac{1}{3}\delta)D)
$</p><p>Where $\delta$ is the duration of the dradient, $\Delta$ is the diffusion time (the time between the two leading edges of the gradient pulses), $G$ is the gradient strength, $S$ is the measured signal, $S_0$ is the measured signal in the absence of diffusion weighting gradient, $\gamma$ is the gyromagnetic ratio and $D$ is the diffusion coefficient.</p><p>We can rewrite this equation:</p><p>$
S = S_0e^{-bD}
$</p><p>where $b$ is the b-value, defined by:</p><p>$
b = \gamma^2G^2\delta^2(\Delta-\frac{1}{3}\delta)
$</p><p>This value has units s/mm² and represents the sensitivity of the sequence to motion. A high b-value indicates a greater diffusion weighting of the image.</p><h4 id=dti>DTI<a hidden class=anchor aria-hidden=true href=#dti>#</a></h4><p><a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC1275686/pdf/biophysj00080-0261.pdf>MR Diffusion Tensor Spectroscopy and Imaging</a> (1994)</p><p>If the diffusion is anisotropic, Basser et al [MR Diffusion Tensor Spectroscopy and Imaging] derived a formula that relates the signal attenuation to the diffusion tensor $\textbf{D}$ by:</p><p>$
\frac{S}{S_0} = e^{-\textbf{B}:\textbf{D}}
$</p><p>with :</p><p>$
\textbf{B} = \begin{bmatrix}
br_x^2 & br_xr_y & br_xr_z \\
br_xr_y & br_y^2 & br_yr_z \\
br_xr_z & br_yr_z & br_z^2
\end{bmatrix}
$</p><p>where $\textbf{r} = (r_x, r_y, r_z)$ is the gradient direction.</p><p>We can then write :</p><p>$
S(b,\textbf{r}) = S_0e^{-br_x^2D_{xx}-br_y^2D_{yy}-br_z^2D_{zz}-2br_xr_yD_{xy}-2br_xr_zD_{xz}-2br_yr_zD_{yz}} = S_0e^{—b\textbf{r}^T\textbf{Dr}}
$</p><p>We therefore need a minimum of six non-collinear diffusion measurements to fully estimate the diffusion tensor coefficients :</p><p>$
\mathbf{d} = \mathbf{H}^{-1}\mathbf{Y}
$</p><p>with $\mathbf{d} = \begin{bmatrix}
D_{xx} \\
D_{yy} \\
D_{zz} \\
D_{xy} \\
D_{xz} \\
D_{yz} \\
\end{bmatrix}$, $\quad \mathbf{H} = \begin{bmatrix}
r_{x1}^2 & r_{y1}^2 & r_{z1}^2 & 2r_{x1}r_{y1} & 2r_{x1}r_{z1} & 2r_{y1}r_{z1}\\
& & &.\\
& & &.\\
& & &.\\
& & &.\\
r_{x6}^2 & r_{y6}^2 & r_{z6}^2 & 2r_{x6}r_{y6} & 2r_{x6}r_{z6} & 2r_{y6}r_{z6} \\
\end{bmatrix}$, $\quad \textbf{Y} = \begin{bmatrix}
\frac{\ln(\frac{S_0}{S_1})}{b} \\
. \\
. \\
. \\
. \\
\frac{\ln(\frac{S_0}{S_6})}{b}
\end{bmatrix}$</p><p>In each voxel of 3D DWI image, the diffusion tensor may be visualized as an ellipsoid with the eigenvectors defining the directions of the principal axes and the ellipsoidal radii defined by the eigenvalues. When the diffusion is isotropic, all the eigenvalues are nearly equal. Otherwise, the eigenvalues are significantly different in magnitude. Tissue injury, diseases or normal physiological changes like aging modify the local tissue microstructure and therefore the eigenvalue magnitudes. The diffusion tensor is therefore a sensitive probe for characterizing both normal and abnormal tissue microstructure.</p><p><img loading=lazy src=../../projects/dwi/ellipse.png alt="source : https://medium.com/@ayt.hsueh/%E6%93%B4%E6%95%A3%E5%BC%B5%E9%87%8F%E5%BD%B1%E5%83%8F%E8%99%95%E7%90%86-diffusion-tensor-imaging-dti-processing-%E4%B8%80-%E5%90%8D%E8%A9%9E%E4%BB%8B%E7%B4%B9-501d936be611 "></p><p><img loading=lazy src=../../projects/dwi/3d_screenshot_CSD.png alt=3d_screenshot_CSD></p><p><img loading=lazy src=../../projects/dwi/3d_screenshot_DTI.png alt=3d_screenshot_DTI></p><p><a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6585735/pdf/NBM-32-na.pdf>Modelling white matter with spherical deconvolution: How and why?</a></p><p><a href="https://imaging.mrc-cbu.cam.ac.uk/imaging/AnalyzingDiffusion?action=AttachFile&amp;do=get&amp;target=Diffusion_and_MRI.pdf">Diffusion and MRI</a></p><p><a href=https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2041910/pdf/13311_2011_Article_40300316.pdf>https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2041910/pdf/13311_2011_Article_40300316.pdf</a></p></div><footer class=post-footer><ul class=post-tags></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on x" href="https://x.com/intent/tweet/?text=Diffusion-weighted%20imaging%20theory&amp;url=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f&amp;title=Diffusion-weighted%20imaging%20theory&amp;summary=Diffusion-weighted%20imaging%20theory&amp;source=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f&title=Diffusion-weighted%20imaging%20theory"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on whatsapp" href="https://api.whatsapp.com/send?text=Diffusion-weighted%20imaging%20theory%20-%20http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on telegram" href="https://telegram.me/share/url?text=Diffusion-weighted%20imaging%20theory&amp;url=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Diffusion-weighted imaging theory on ycombinator" href="https://news.ycombinator.com/submitlink?t=Diffusion-weighted%20imaging%20theory&u=http%3a%2f%2flocalhost%3a1313%2fJulienGenzling.github.io%2fprojects%2fdwi%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/JulienGenzling.github.io/>JG</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>